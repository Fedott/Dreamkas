<?xml-stylesheet href="../-mix/doc.stage=dev.xsl" type="text/xsl"?>
<doc_root
    doc_title="lh_product_edit"
    >
    
    <div id="lh_product_edit_test" lh_desktop="true">
        <data lh_application_view="lh_product_edit">
            <product>
                <id>1</id>
                <sku>GVOZDI007</sku>
                <name>Гвозди 47 колибра</name>
                <vendor>Рога и копыта</vendor>
                <vendorCountry>Россия</vendorCountry>
                <purchasePrice>100500</purchasePrice>
                <barcode>0123456789</barcode>
                <units>unit</units>
                <vat>10</vat>
                <info>У нас их дофига!</info>
            </product>
        </data>
    </div>
    
    <p>
        <script type="wc_test" wc_test_title="lh_product_edit: подхватываются ли текущие значения?">
            var node= document.querySelector( '#lh_product_edit_test [lh_product_edit]' )
            var data= $lh_product_edit( node ).data()
            
            test.ok( data.name(), 'product' )
            
            test.ok( data.select( 'id' )[0].text(), '1' )
            test.ok( data.select( 'sku' )[0].text(), 'GVOZDI007' )
            test.ok( data.select( 'name' )[0].text(), 'Гвозди 47 колибра' )
            test.ok( data.select( 'vendor' )[0].text(), 'Рога и копыта' )
            test.ok( data.select( 'vendorCountry' )[0].text(), 'Россия' )
            test.ok( data.select( 'purchasePrice' )[0].text(), '100500' )
            test.ok( data.select( 'barcode' )[0].text(), '0123456789' )
            test.ok( data.select( 'units' )[0].text(), 'unit' )
            test.ok( data.select( 'vat' )[0].text(), '10' )
            test.ok( data.select( 'info' )[0].text(), 'У нас их дофига!' )
        </script>
    </p>
    
    <p>
        <script type="wc_test" wc_test_title="lh_product_create: отсылается ли форма?">
            var editor= document.getElementById( 'lh_product_edit_test' )
            
            var result= false
            $lh_product_onSave.listen( editor, function( event ){
                event.catched( true )
                result= true
            })
            
            editor.querySelector( '[lh_button="commit"]' ).click()
            
            test.ok( result )
        </script>
    </p>
</doc_root>
