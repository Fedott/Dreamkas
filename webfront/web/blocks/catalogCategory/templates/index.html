<%
/**
 * @catalogCategoryModel
 * @catalogSubcategoriesCollection
 * @storeProductsCollection
 */
  %>

<% var table_subcategoryBalance = require('tpl!blocks/table/table_subcategoryBalance/table_subcategoryBalance.html') %>

<% if (LH.isAllow('subcategories', 'POST')) { %>
<div class="page__controls">
    <a class="page__controlsLink editor__on">Редактировать</a>
    <a class="page__controlsLink editor__off">Завершить редактирование</a>
</div>
<% } %>

<h1>
    <span style="vertical-align: middle">
        <%= LH.modelNode(catalogCategoryModel, 'name') %>
    </span>
    <a class="editor__editLink catalog__editCategoryLink"></a>
    <a lh-button class="button catalog__addSubCategoryLink editor__control">
        Добавить подкатегорию
    </a>
</h1>
<div class="page__tabs">
    <a class="page__tabItem page__tabItem_active" rel="subcategoryList">
        Подкатегории
    </a>
    <% if(LH.isAllow('categories', 'PUT::{category}')) { %>
    <a class="page__tabItem" rel="categoryProperties">
        Свойства
    </a>
    <% } %>
</div>
<div class="page__tabsContent">
    <div class="page__tabContentItem page__tabContentItem_active" rel="subcategoryList">
        <div id="catalogCategory__subcategoryList">
            <%= templates.catalogCategory__subcategoryList({
            templates: templates,
            catalogSubcategoriesCollection: catalogSubcategoriesCollection
            }) %>
        </div>

        <div class="catalogCategory__productList">
            <h4>
                <span class="catalogCategory__productListTitle">Список товаров</span>
                <a lh-button style="margin-left: 15px;" href="/products/create?subcategory=<%- catalogSubCategoryId %>"
                   class="button catalogCategory__addProductLink editor__control">
                    Добавить товар
                </a>
            </h4>
            <div class="page__tabs">
                <a href="/catalog/<%- catalogCategoryModel.get('group') + '/' + catalogCategoryModel.id + '/' + catalogSubCategoryId %>/products" class="page__tabItem <%- section === 'products' ? 'page__tabItem_active' : '' %>" rel="productList">
                    Продукты
                </a>
                <% if(storeId){ %>
                <a href="/catalog/<%- catalogCategoryModel.get('group') + '/' + catalogCategoryModel.id + '/' + catalogSubCategoryId %>/balance" class="page__tabItem <%- section === 'balance' ? 'page__tabItem_active' : '' %>" rel="balance">
                    Остатки
                </a>
                <% } %>
                <% if(LH.isAllow('subcategories', 'PUT::{subcategory}')) { %>
                <a href="/catalog/<%- catalogCategoryModel.get('group') + '/' + catalogCategoryModel.id + '/' + catalogSubCategoryId %>/properties" class="page__tabItem <%- section === 'properties' ? 'page__tabItem_active' : '' %>" rel="subcategoryProperties">
                    Свойства
                </a>
                <% } %>
            </div>
            <div class="page__tabsContent">
                <div class="page__tabContentItem <%- section === 'products' ? 'page__tabContentItem_active' : '' %>" rel="productList">
                    <div class="catalogCategory__productListNotification">
                        Нет продуктов
                    </div>
                    <table class="table table_products"></table>
                </div>
                <% if(storeId){ %>
                <div class="page__tabContentItem <%- section === 'balance' ? 'page__tabContentItem_active' : '' %>" rel="balance">
                    <div class="catalogCategory__productListNotification">
                        Нет продуктов
                    </div>
                    <%= table_subcategoryBalance({
                        collection: storeProductsCollection
                    }) %>
                </div>
                <% } %>
                <% if(LH.isAllow('subcategories', 'PUT::{subcategory}')) { %>
                <div class="page__tabContentItem <%- section === 'properties' ? 'page__tabContentItem_active' : '' %>" rel="subcategoryProperties">
                    <form id="form_catalogSubCategoryProperties" class="form"></form>
                </div>
                <% } %>
            </div>
        </div>
        <div style="clear: both;"></div>
    </div>
    <% if(LH.isAllow('categories', 'PUT::{category}')) { %>
    <div class="page__tabContentItem" rel="categoryProperties">
        <form id="form_catalogCategoryProperties" class="form"></form>
    </div>
    <% } %>
</div>

